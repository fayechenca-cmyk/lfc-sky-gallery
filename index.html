<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>LFC SYSTEM: Sky Gallery</title>

  <!-- Three.js + Tween.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,500;1,500&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0; overflow:hidden;
      background:linear-gradient(to bottom,#e0f2fe 0%,#f0f9ff 100%);
      font-family:'Montserrat',sans-serif;
      touch-action:none; user-select:none;
    }

    #canvas-container{ position:fixed; inset:0; }

    /* UI overlay */
    #ui-layer{ position:fixed; inset:0; pointer-events:none; z-index:10; }

    /* HUD */
    #hud{ position:absolute; top:2rem; left:2rem; pointer-events:auto; }
    #hud h1{
      font-weight:800; font-size:1.6rem; margin:0;
      color:#1e3a8a; letter-spacing:-1px; text-transform:uppercase;
    }
    .subtitle{
      font-size:10px; font-weight:600; text-transform:uppercase;
      letter-spacing:3px; color:#1e40af; margin-top:6px;
      display:flex; align-items:center; gap:8px;
    }
    .live-dot{ width:6px; height:6px; background:#22c55e; border-radius:50%; box-shadow:0 0 10px #22c55e; }

    /* Journey button */
    #journey-btn{
      margin-top:1.2rem;
      background:#fff; border:1px solid #1e3a8a;
      padding:0.9rem 1.2rem;
      border-radius:8px;
      cursor:pointer;
      display:flex; align-items:center; gap:12px;
      font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1px;
      transition:transform 0.2s, box-shadow 0.2s;
      pointer-events:auto;
      box-shadow:0 6px 24px rgba(0,0,0,0.10);
    }
    #journey-btn:hover{ transform:translateY(-2px); box-shadow:0 10px 30px rgba(0,0,0,0.15); }
    .counter{
      background:#1e3a8a; color:#fff;
      width:20px; height:20px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:10px;
    }

    /* Elevator */
    #elevator{
      position:absolute; top:50%; right:1.2rem; transform:translateY(-50%);
      display:flex; flex-direction:column; gap:6px;
      pointer-events:auto;
      max-height:70vh; overflow-y:auto; padding:10px 0;
      scrollbar-width:none;
    }
    .floor-item{
      display:flex; align-items:center; justify-content:flex-end; gap:10px;
      cursor:pointer; transition:transform 0.15s, opacity 0.15s;
      opacity:0.75; padding:4px 0;
    }
    .floor-item:hover, .floor-item.active{ opacity:1; transform:translateX(-6px); }
    .floor-label{
      background:rgba(255,255,255,0.92);
      padding:8px 14px; border-radius:10px;
      font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:1px;
      box-shadow:0 6px 16px rgba(0,0,0,0.06);
      color:#1e3a8a; white-space:nowrap; backdrop-filter:blur(8px);
    }
    .floor-num{
      width:32px; height:32px;
      background:#fff; color:#1e3a8a;
      border:1px solid #1e3a8a;
      display:flex; align-items:center; justify-content:center;
      font-size:11px; font-weight:800; border-radius:50%;
      box-shadow:0 6px 16px rgba(0,0,0,0.10);
    }
    .floor-item.active .floor-num{ background:#1e3a8a; color:#fff; }

    /* Back button */
    #back-btn{
      position:absolute; bottom:2rem; left:50%;
      transform:translateX(-50%) translateY(80px);
      background:#1e3a8a; color:#fff;
      padding:0.9rem 2.2rem;
      font-weight:800; font-size:12px;
      text-transform:uppercase; letter-spacing:2px;
      cursor:pointer; pointer-events:auto;
      opacity:0; transition:all 0.35s;
      box-shadow:0 18px 40px rgba(0,0,0,0.18);
      border-radius:999px;
    }
    #back-btn.visible{ opacity:1; transform:translateX(-50%) translateY(0); }

    /* Right AI panel (safe offline version) */
    #ai-panel{
      position:absolute; top:0; right:0; bottom:0; width:440px; max-width:100%;
      background:rgba(255,255,255,0.96); backdrop-filter:blur(18px);
      transform:translateX(100%);
      transition:transform 0.45s cubic-bezier(0.22,1,0.36,1);
      pointer-events:auto;
      display:flex; flex-direction:column;
      z-index:50;
      box-shadow:-20px 0 50px rgba(0,0,0,0.08);
      border-left:1px solid rgba(0,0,0,0.08);
    }
    #ai-panel.active{ transform:translateX(0); }

    .ai-header{ padding:1.6rem; border-bottom:1px solid #eef2f7; background:#fbfdff; position:relative; }
    .panel-close{ position:absolute; top:14px; right:14px; font-size:22px; cursor:pointer; color:#1e3a8a; }
    .ai-img-preview{ width:100%; height:170px; object-fit:contain; background:#f3f6fb; border-radius:12px; }
    .ai-title{ font-family:'Playfair Display'; font-size:1.6rem; margin:0.9rem 0 0.2rem; color:#1e3a8a; }
    .ai-meta{ font-size:11px; text-transform:uppercase; color:#64748b; letter-spacing:0.6px; }

    .mode-switcher{ display:flex; background:#f1f5f9; padding:4px; margin-top:12px; border-radius:12px; }
    .mode-btn{
      flex:1; padding:10px; border:none; cursor:pointer;
      font-size:10px; font-weight:800; text-transform:uppercase;
      color:#94a3b8; background:transparent; border-radius:10px;
    }
    .mode-btn.active{ background:#fff; color:#1e3a8a; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
    .mode-btn.locked{ opacity:0.55; }

    #chat-stream{
      flex:1; padding:1.4rem; overflow-y:auto;
      display:flex; flex-direction:column; gap:0.8rem;
    }
    .msg{
      padding:14px 16px; border-radius:14px;
      font-size:14px; line-height:1.55; max-width:90%;
    }
    .msg-ai{ background:#f8fafc; color:#334155; align-self:flex-start; border-left:3px solid #1e3a8a; }
    .msg-user{ background:#111; color:#fff; align-self:flex-end; }

    .chat-input-area{
      padding:1rem; border-top:1px solid #eef2f7;
      background:#fff; display:flex; gap:10px; align-items:center;
    }
    #user-input{
      flex:1; padding:12px 12px; border:1px solid #cbd5e1;
      font-family:'Montserrat',sans-serif; font-size:14px;
      outline:none; border-radius:12px;
    }
    #user-input:focus{ border-color:#1e3a8a; }
    #send-btn{
      background:#1e3a8a; color:#fff; border:none;
      padding:12px 16px; cursor:pointer;
      font-weight:800; font-size:12px; text-transform:uppercase;
      border-radius:12px;
    }

    /* Registration + Blueprint */
    #registration, #blueprint{
      position:fixed; inset:0;
      background:rgba(255,255,255,0.98);
      z-index:60;
      opacity:0; pointer-events:none;
      transition:opacity 0.25s;
      display:flex; align-items:center; justify-content:center;
      padding:2rem;
    }
    #registration.active, #blueprint.active{ opacity:1; pointer-events:auto; }
    .close-bp{ position:absolute; top:1.2rem; right:1.2rem; font-size:2rem; cursor:pointer; color:#1e3a8a; }

    .reg-card{
      width:100%; max-width:420px;
      background:#fff; border:1px solid #eef2f7;
      padding:2rem; border-radius:18px;
      box-shadow:0 20px 60px rgba(0,0,0,0.12);
    }
    .form-group{ margin:1rem 0; }
    .form-label{ display:block; font-size:11px; font-weight:800; text-transform:uppercase; letter-spacing:1px; color:#64748b; margin-bottom:8px; }
    .form-select{ width:100%; padding:12px; border:1px solid #dbe4f0; border-radius:12px; font-family:'Montserrat'; }

    .plan-btn{
      width:100%;
      padding:0.9rem 1rem;
      background:#1e3a8a; color:#fff;
      border:none; border-radius:999px;
      text-transform:uppercase; font-weight:900;
      cursor:pointer; letter-spacing:1px;
      margin-top:0.5rem;
    }

    .bp-wrap{
      width:min(920px, 96vw);
      display:grid; grid-template-columns: 1fr 1fr;
      gap:2rem;
      background:#fff;
      border:1px solid #eef2f7;
      border-radius:22px;
      box-shadow:0 22px 70px rgba(0,0,0,0.14);
      overflow:hidden;
    }
    .bp-left{ padding:2rem; border-right:1px solid #eef2f7; }
    .bp-right{ padding:2rem; display:flex; flex-direction:column; gap:1rem; }
    .bp-title{ font-family:'Playfair Display'; font-size:2.2rem; margin:0 0 0.5rem; color:#1e3a8a; }
    .bp-desc{ color:#475569; margin:0; line-height:1.6; }
    .bp-step{ margin-top:1rem; padding:12px 12px; border-radius:14px; background:#f8fafc; border:1px solid #eef2f7; }
    .bp-step b{ display:block; font-size:11px; letter-spacing:1px; text-transform:uppercase; color:#22c55e; margin-bottom:6px; }

    .plan-card{
      border:1px solid #eef2f7; border-radius:18px;
      padding:1.4rem; transition:transform 0.2s, box-shadow 0.2s, border-color 0.2s;
      cursor:pointer;
    }
    .plan-card:hover{ border-color:#1e3a8a; transform:translateY(-4px); box-shadow:0 14px 40px rgba(0,0,0,0.10); }
    .plan-price{ font-family:'Playfair Display'; font-size:1.6rem; color:#0f172a; }

    /* Loader */
    #loader{
      position:fixed; inset:0; background:#fff; z-index:100;
      display:flex; align-items:center; justify-content:center; flex-direction:column;
    }
    .loader-bar{ width:220px; height:3px; background:#e2e8f0; overflow:hidden; border-radius:999px; margin-top:1rem; }
    .loader-fill{ width:0%; height:100%; background:#1e3a8a; transition:width 0.3s; }

    /* Transition shield */
    #transition-shield{
      position:fixed; inset:0; background:#fff; z-index:90;
      display:flex; align-items:center; justify-content:center;
      opacity:0; pointer-events:none;
      transition:opacity 0.25s;
    }
    #transition-shield.active{ opacity:1; pointer-events:auto; }
    .travel-text{ font-weight:900; letter-spacing:4px; font-size:12px; color:#0f172a; }

    /* Toast */
    #toast{
      position:fixed; top:18px; left:50%; transform:translateX(-50%);
      background:#1e3a8a; color:#fff;
      padding:10px 16px; border-radius:999px;
      font-size:12px; font-weight:900; text-transform:uppercase; letter-spacing:1px;
      opacity:0; transition:opacity 0.2s; z-index:200; pointer-events:none;
    }
    #toast.active{ opacity:1; }
  </style>
</head>

<body>
  <div id="toast">Updated</div>
  <div id="transition-shield"><div class="travel-text">ACCESSING FLOOR...</div></div>

  <div id="ui-layer">
    <div id="hud">
      <h1>LFC SYSTEM</h1>
      <div class="subtitle"><div class="live-dot"></div> SKY GALLERY</div>

      <div id="journey-btn">
        <span>My Journey</span>
        <div class="counter" id="journey-count">0</div>
      </div>
    </div>

    <div id="elevator"></div>

    <div id="back-btn">← Return to Gallery</div>

    <!-- AI panel (OFFLINE SAFE) -->
    <div id="ai-panel">
      <div class="ai-header">
        <span class="panel-close" id="panel-close">×</span>
        <img id="ai-img" class="ai-img-preview" src="" alt="Artwork preview" />
        <h2 class="ai-title" id="ai-title">Untitled</h2>
        <div class="ai-meta" id="ai-meta"></div>

        <div class="mode-switcher">
          <button class="mode-btn active" id="btn-docent">Docent</button>
          <button class="mode-btn locked" id="btn-curator" title="Premium (not enabled)">Curator</button>
        </div>
      </div>

      <div id="chat-stream"></div>

      <div class="chat-input-area">
        <input type="text" id="user-input" placeholder="Ask about this artwork..." />
        <button id="send-btn">Send</button>
      </div>
    </div>

    <!-- Registration -->
    <div id="registration">
      <div class="close-bp" id="close-registration">×</div>
      <div class="reg-card">
        <h2 style="font-family:'Playfair Display'; margin:0 0 6px;">Visitor Registration</h2>
        <p style="margin:0 0 14px; color:#475569; line-height:1.6;">
          Quick 10-second setup so the “Journey” can generate a learning path.
        </p>

        <div class="form-group">
          <label class="form-label">Age Group</label>
          <select id="reg-age" class="form-select">
            <option>Teenager</option>
            <option>Adult</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Goal</label>
          <select id="reg-goal" class="form-select">
            <option>Learn Art</option>
            <option>Collect</option>
            <option>Teach / Curate</option>
          </select>
        </div>

        <button class="plan-btn" id="submit-registration">Generate Curriculum</button>
      </div>
    </div>

    <!-- Blueprint -->
    <div id="blueprint">
      <div class="close-bp" id="close-blueprint">×</div>
      <div class="bp-wrap">
        <div class="bp-left">
          <h2 class="bp-title" id="bp-title">Generating...</h2>
          <p class="bp-desc" id="bp-desc">Analyzing your journey…</p>
          <div id="bp-steps"></div>
        </div>
        <div class="bp-right">
          <div class="plan-card">
            <div style="font-weight:900; letter-spacing:1px; text-transform:uppercase; font-size:12px; color:#1e3a8a;">LFC Live Studio</div>
            <div class="plan-price">$450</div>
            <div style="color:#475569; margin-top:8px; line-height:1.55;">Guided critique + creation sessions based on your journey tags.</div>
          </div>
          <div class="plan-card">
            <div style="font-weight:900; letter-spacing:1px; text-transform:uppercase; font-size:12px; color:#1e3a8a;">Self-Guided</div>
            <div class="plan-price">$120</div>
            <div style="color:#475569; margin-top:8px; line-height:1.55;">Use the generated blueprint as a structured practice plan.</div>
          </div>
          <div style="font-size:12px; color:#64748b; line-height:1.55;">
            (These are placeholders — you can link them later to your real checkout/pages.)
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="loader">
    <div style="font-weight:900; letter-spacing:3px; font-size:12px; text-transform:uppercase; color:#0f172a;">Loading Gallery…</div>
    <div class="loader-bar"><div class="loader-fill" id="load-fill"></div></div>
  </div>

  <div id="canvas-container"></div>

  <script src="./app.js"></script>
</body>
</html>
