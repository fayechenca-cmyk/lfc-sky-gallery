<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>LFC SKY ARTSPACE</title>
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="canvas-container"></div>

  <div id="onboarding-tip">Click Artwork to Chat</div>

  <div id="onboarding-card" aria-hidden="true">
    <div class="close-x" id="onboarding-close">√ó</div>
    <h3>Quick Guide</h3>
    <p>
      ‚Ä¢ Rotate view: mouse drag / trackpad drag<br>
      ‚Ä¢ Move: WASD / Arrow keys / on-screen pad<br>
      ‚Ä¢ Jump quickly: use the right elevator buttons<br>
      ‚Ä¢ Return to walk: ‚ÄúReturn to Walk‚Äù button (or close the panel)
    </p>
    <div class="mini-row">
      <button class="reg-btn mini-btn" id="onboarding-gotit">Got it</button>
    </div>
  </div>

  <div id="teleport-toast">Teleporting...</div>

  <div id="nav-preview" role="tooltip" aria-hidden="true">
    <img class="thumb" id="nav-preview-thumb" src="" alt="" />
    <div class="body">
      <div class="title" id="nav-preview-title">Preview</div>
      <div class="meta" id="nav-preview-meta">Loading...</div>
    </div>
  </div>

  <div id="entrance-layer">
    <div class="door-panel left"></div>
    <div class="door-panel right"></div>
    <div id="entrance-content">
      <div class="poster-title">LFC Sky Artspace</div>
      <div class="poster-tagline">Learning From Collections</div>
      <div class="poster-desc">
        From Viewing to Knowing. From Knowing to Making.<br><br>
        LFC Sky Artspace is a collection-led art education system that mirrors the experience of learning inside a real art space‚Äîonline.
        <br><br>
        <strong>Collection-to-Creation Framework (CCF)</strong><br>
        Visit ‚Üí Analyze ‚Üí Discuss ‚Üí Connect ‚Üí Create
      </div>
      <button class="begin-btn" onclick="showRegistration()">Begin Journey</button>
    </div>
  </div>

  <div id="reg-panel">
    <h2 style="color:var(--blue); margin-bottom:0.5rem; font-weight:800;">VISITOR PROFILE</h2>
    <p style="color:var(--gray); margin-bottom:1.5rem; font-size:13px;">
      Help us curate your experience.
    </p>

    <span class="section-label">I‚ÄôM VISITING AS... (Pick 1)</span>
    <div class="reg-options" id="opt-role">
      <button class="reg-btn" onclick="toggleRole(this)">Student</button>
      <button class="reg-btn" onclick="toggleRole(this)">Artist</button>
      <button class="reg-btn" onclick="toggleRole(this)">Viewer</button>
      <button class="reg-btn" onclick="toggleRole(this)">Collector</button>
      <button class="reg-btn" onclick="toggleRole(this)">Art Lover</button>
      <button class="reg-btn" onclick="toggleRole(this)">Parent/Educator</button>
    </div>

    <span class="section-label">AGE GROUP... (Pick 1)</span>
    <div class="reg-options" id="opt-age">
      <button class="reg-btn" onclick="toggleAge(this, 'Child')">Under 12</button>
      <button class="reg-btn" onclick="toggleAge(this, 'Teen')">12 - 18</button>
      <button class="reg-btn" onclick="toggleAge(this, 'Adult')">Adult</button>
    </div>

    <span class="section-label">MY GOAL TODAY... (Max 2)</span>
    <div class="reg-options" id="opt-goal">
      <button class="reg-btn" onclick="toggleGoal(this)">Learn Techniques</button>
      <button class="reg-btn" onclick="toggleGoal(this)">Learn Art History</button>
      <button class="reg-btn" onclick="toggleGoal(this)">Explore Meaning & Ideas</button>
      <button class="reg-btn" onclick="toggleGoal(this)">Understand Collecting/Market</button>
    </div>

    <span class="section-label">I‚ÄôM CURIOUS ABOUT... (Optional, Max 3)</span>
    <div class="reg-options keyword-grid" id="opt-interests">
      <button class="reg-btn" onclick="toggleInterest(this)">Modern & Contemporary</button>
      <button class="reg-btn" onclick="toggleInterest(this)">Social Themes</button>
      <button class="reg-btn" onclick="toggleInterest(this)">Impressionism</button>
      <button class="reg-btn" onclick="toggleInterest(this)">Painting</button>
      <button class="reg-btn" onclick="toggleInterest(this)">Sculpture</button>
      <button class="reg-btn" onclick="toggleInterest(this)">Photography</button>
      <button class="reg-btn" onclick="toggleInterest(this)">Digital Art</button>
      <button class="reg-btn" onclick="toggleInterest(this)">Abstract</button>
      <button class="reg-btn" onclick="toggleInterest(this)">History</button>
      <button class="reg-btn" onclick="toggleInterest(this)">Philosophy</button>
    </div>

    <div style="margin-top: 2rem; display: flex; flex-direction: column; align-items: center; gap: 10px;">
      <button id="final-enter-btn" class="final-enter-btn" onclick="completeRegistration()">Enter Gallery</button>
      <button id="skip-btn" class="skip-link" onclick="skipRegistration()">Skip for now</button>
    </div>
  </div>

  <div id="lab-trigger" onclick="creatorLab.toggle()">
    <span id="lab-trigger-icon">‚ö°</span>
    <span id="lab-trigger-text">Open Lab</span>
  </div>

  <div id="creator-lab-overlay" class="lab-hidden">
    <div class="lab-header">
        <h2 id="lab-title">Project Dashboard</h2>
        <button class="lab-close-btn" style="background:none; border:none; color:inherit; font-size:1.5rem; cursor:pointer;" onclick="creatorLab.toggle()">√ó</button>
    </div>
    <div class="lab-content">
        <div class="lab-section">
            <h3 id="label-name">Project Name</h3>
            <input type="text" id="project-name-input" class="lab-input" placeholder="...">
            <h3 id="label-goal">Core Objective</h3>
            <textarea id="project-goal-input" class="lab-input" rows="3" placeholder="..."></textarea>
        <h3 id="label-contact-email">Email (Required)</h3>
        <input type="email" id="contact-email-input" class="lab-input" placeholder="name@example.com" autocomplete="email" required>

        <h3 id="label-contact-other">Preferred Contact (Optional)</h3>
      <input type="text" id="contact-other-input" class="lab-input" placeholder="WeChat / WhatsApp / Phone">

         <div id="lab-inline-message"></div>
        </div>
        <div class="lab-section">
            <h3 id="label-refs">Reference Board</h3>
            <div id="lab-gallery-pins" class="lab-grid">
                <div class="lab-empty-state" style="grid-column: span 2; font-size:11px; opacity:0.6;">No artworks pinned yet. Click "Start LFC Project" in the chat.</div>
            </div>
        </div>
        <div class="lab-section">
            <h3 id="label-steps">Workflow</h3>
            <ul id="lab-milestone-list" style="list-style:none; padding:0;"></ul>
            <button id="btn-add-step" class="lab-action-btn small">+ Add Step</button>
        </div>
        <div class="lab-footer">
            <button id="btn-help" class="lab-secondary-btn">Request Mentor</button>
            <button id="btn-submit" class="lab-primary-btn">Submit Project</button>
        </div>
    </div>
  </div>

  <div id="ui-layer">
    <div id="hud">
      <h1>LFC SYSTEM</h1>

      <div class="subtitle">
        <div class="live-dot"></div> SKY ARTSPACE
        <span id="whereami-text" class="floor-label" style="padding:4px 10px; font-size:9px;">Atrium</span>
      </div>

      <div id="journey-wrapper">
        <div id="journey-btn" onclick="startBlueprint()">
          <span>My Journey</span>
        </div>
        <div class="discovery-text">Discovery Progress</div>
        <div class="discovery-bar-bg">
          <div class="discovery-bar-fill" id="discovery-fill"></div>
        </div>
      </div>
    </div>

    <div id="elevator"></div>

    <div id="home-btn" onclick="goHome()">‚åÇ Atrium</div>

    <div id="back-btn" onclick="exitFocus()">‚Üê Return to Walk</div>
    
    <div id="ai-panel">
      <span class="panel-close" onclick="exitFocus()">√ó</span>
      
      <div class="ai-left">
        <div id="ai-img-viewport" class="ai-img-preview" tabindex="0" aria-label="Artwork image viewer" style="position:relative; width:100%; height:100%; max-height: 60vh; display:flex; align-items:center; justify-content:center; overflow:hidden;">
          <img id="ai-img" class="ai-img-preview" src="" onclick="openLightbox(this.src)" title="Click to enlarge" style="max-height:100%; max-width:100%; object-fit:contain; cursor:zoom-in;" />
          <button id="ai-zoom-reset" class="reg-btn" style="position:absolute; right:10px; top:10px; padding:8px 10px; font-size:9px;">Reset Zoom</button>
          <div id="ai-zoom-hint" style="position:absolute; left:12px; bottom:10px; font-size:9px; font-weight:800; letter-spacing:1px; color:var(--blue);"></div>
        </div>
        
        <div style="margin-top: 20px; text-align: center;">
          <h2 style="font-weight:800; margin:0; color:var(--blue); font-size:1.6rem;" id="ai-title">Untitled</h2>
          <div style="font-size:12px; text-transform:uppercase; color:var(--gray); margin-top:8px; font-weight:600;" id="ai-meta">Artist ‚Ä¢ Year ‚Ä¢ Medium</div>
        </div>
      </div>

      <div class="ai-right">
        <div class="ai-header" style="padding-bottom:10px;">
          <button class="pin-btn" onclick="pinCurrentArt()">üìå Start LFC Project</button>
          
          <div style="display:flex; gap:8px; margin-top:12px; align-items:center; flex-wrap:wrap; clear:both;">
            <button id="mode-docent" class="reg-btn" style="padding:8px 12px; font-size:9px;" onclick="setAIPersona('docent')">Docent</button>
            <button id="mode-curator" class="reg-btn" style="padding:8px 12px; font-size:9px;" onclick="setAIPersona('curator')">Curator</button>
          </div>
          <button id="btn-thinking-quest" class="reg-btn" style="padding:8px 12px; font-size:9px; margin-top:10px;" type="button">Thinking Quest</button>
        </div>
        
        <div id="chat-stream"></div>
        
        <div class="chat-input-area">
          <input type="text" id="user-input" placeholder="Ask about this piece..." />
          <button id="send-btn">Send</button>
        </div>
      </div>
    </div>

    <div id="blueprint">
      <div class="panel-close" onclick="closeBlueprint()" style="top:2rem; right:2rem; font-size: 2rem;">√ó</div>
      <div class="bp-container">
        <div>
          <h2 style="font-weight:800; font-size: 2.5rem; color: var(--blue); margin-bottom: 0.5rem;">Your Curriculum</h2>
          <p style="color: #64748b; line-height: 1.6;" id="bp-desc"></p>
          <div id="bp-steps" style="margin-top:2rem;"></div>
          
          <div id="bp-quest" style="margin-top:18px;"></div>
        </div>
        <div id="bp-products"></div>
      </div>
    </div>
  </div>

  <div id="lightbox-modal" onclick="closeLightbox()">
     <img id="lightbox-img" src="" />
     <div class="lightbox-close">√ó</div>
  </div>

  <div id="nav-pad">
    <div class="pad">
      <div></div><button onmousedown="moveStart('f')" ontouchstart="moveStart('f')" onmouseup="moveStop()" ontouchend="moveStop()">‚ñ≤</button><div></div>
      <button onmousedown="moveStart('l')" ontouchstart="moveStart('l')" onmouseup="moveStop()" ontouchend="moveStop()">‚óÄ</button>
      <button onclick="moveStop()">‚óè</button>
      <button onmousedown="moveStart('r')" ontouchstart="moveStart('r')" onmouseup="moveStop()" ontouchend="moveStop()">‚ñ∂</button>
      <div></div><button onmousedown="moveStart('b')" ontouchstart="moveStart('b')" onmouseup="moveStop()" ontouchend="moveStop()">‚ñº</button><div></div>
    </div>
  </div>

  <script src="js/1-setup.js"></script>
  <script src="js/2-auth.js"></script>
  <script src="js/3-gallery.js"></script>
  <script src="js/4-ai-chat.js"></script>
  <script src="js/5-journey.js"></script>
  <script src="js/6-main.js"></script>
  <script src="js/7-extensions.js"></script>

  <div id="tq-overlay" aria-hidden="true" style="position:fixed; inset:0; z-index:9200; display:none;">
  <div id="tq-backdrop" style="position:absolute; inset:0; background:rgba(15,23,42,0.35); backdrop-filter:blur(10px);"></div>

  <div id="tq-card" style="
    position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:92%; max-width:760px;
    background:rgba(255,255,255,0.94);
    border:1px solid rgba(255,255,255,0.85);
    border-radius:20px;
    box-shadow:0 30px 70px rgba(0,0,0,0.18);
    padding:18px 18px 16px 18px;
    font-family:Montserrat,sans-serif; color:#0f172a;
  ">
    <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px;">
      <div>
        <div style="font-size:10px; font-weight:900; letter-spacing:2px; text-transform:uppercase; color:#1e3a8a;">LFC Thinking Quest</div>
        <div id="tq-subtitle" style="margin-top:6px; font-size:12px; font-weight:800; color:#334155;">Chapter 1 ¬∑ Level 1: Observe & Stay</div>
        <div id="tq-art" style="margin-top:6px; font-size:11px; font-weight:700; color:#64748b; letter-spacing:1px; text-transform:uppercase;">Artwork: (auto)</div>
      </div>
      <div id="tq-close" style="cursor:pointer; font-size:22px; font-weight:900; color:#1e3a8a; padding:6px 10px;">√ó</div>
    </div>

    <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
      <div style="font-size:10px; font-weight:900; letter-spacing:1px; text-transform:uppercase; color:#64748b;">I am:</div>
      <button class="reg-btn" style="padding:8px 10px; font-size:9px;" data-tq-group="teen" type="button">Teen</button>
      <button class="reg-btn" style="padding:8px 10px; font-size:9px;" data-tq-group="early_adult" type="button">Early Adult</button>
      <button class="reg-btn" style="padding:8px 10px; font-size:9px;" data-tq-group="adult" type="button">Adult</button>
      <button class="reg-btn" style="padding:8px 10px; font-size:9px;" data-tq-group="pro" type="button">Pro</button>

      <div id="tq-group-hint" style="margin-left:auto; font-size:10px; font-weight:800; color:#64748b; letter-spacing:1px; text-transform:uppercase;">Pick one</div>
    </div>

    <div style="margin-top:14px; border-top:1px solid rgba(226,232,240,1); padding-top:14px;">
      <div id="tq-q" style="font-size:13px; font-weight:800; color:#0f172a; line-height:1.6;">Question will appear here.</div>

      <div id="tq-choices" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;"></div>

      <textarea id="tq-text" class="lab-input" rows="3" placeholder="Optional: add one sentence of your own observation..."
        style="margin-top:12px; font-size:13px;"></textarea>

      <div style="display:flex; gap:10px; align-items:center; margin-top:12px;">
        <button id="tq-save" class="reg-btn" style="padding:10px 14px; font-size:10px; font-weight:900;" type="button">Save Judgment Card</button>
        <div id="tq-toast" style="font-size:10px; font-weight:800; color:#64748b; letter-spacing:1px; text-transform:uppercase; display:none;">Saved.</div>
        <div style="margin-left:auto; font-size:10px; font-weight:900; color:#1e3a8a; letter-spacing:1px; text-transform:uppercase;">No exams. Just thinking.</div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
